## 数据链路规划 API 文档

---

## 图像接口API文档

### 接口信息
- **IP 地址**:`127.0.0.1`
- **端口**:`12346`

---

### 客户端请求json格式
示例：
```json
{
  "satellites": [
    {"index": 0, "name": "Hubble", "r": 6789.0, "angle": 132.45, "speed": 3.21},
    {"index": 1, "name": "ISS", "r": 6791.5, "angle": 85.30, "speed": 2.98},
    {"index": 2, "name": "GPS-3", "r": 20345.8, "angle": 14.78, "speed": 1.05}
  ],
  "start": [0],
  "end": [2]
}
```
---

客户端需要的返回结果：
```json
{
    "path": [1, 2, 3]
}
```
---

## 图像绘制接口 API 文档

### 接口信息
- **IP 地址**：`127.0.0.1`  
- **端口**：`12346`

---

### 接收信息格式（服务端 → 客户端）

客户端（前端）将通过 Socket 接收来自后端的 `x` 和 `y` 坐标数据，用于在界面中实时绘图。

#### 数据格式：
数据以字符串形式发送，内容为一组浮点数坐标值，格式如下：

```text
x1,x2,x3,...|y1,y2,y3,...
```

#### 字段说明：

| 字段        | 含义       | 类型                | 示例                    |
| ----------- | ---------- | ------------------- | ----------------------- |
| `x1,x2,...` | 横坐标列表 | float[], 以逗号分隔 | `0.0,0.1,0.2,0.3`       |
| `y1,y2,...` | 纵坐标列表 | float[], 以逗号分隔 | `0.0,0.099,0.198,0.295` |

- `|` 用作 `x` 与 `y` 的分隔符。
- `x` 与 `y` 的元素数量应一致。
- 字符串整体一次发送，不分多包。

#### 示例：

```
0.0,0.1,0.2,0.3|0.0,0.099,0.198,0.295
```

表示坐标为：
```
x = [0.0, 0.1, 0.2, 0.3]
y = [0.0, 0.099, 0.198, 0.295]
```
---

### 错误处理要求

- 若数据格式错误或 `x`、`y` 数量不一致，客户端将忽略本次数据，并记录错误日志；

---

## bpsk和qpsk编码：bpsk_modulate 和 pbsk_modulate

### 接口信息

```python
def bpsk_modulate(bit_seq, carrier_freq=1000, sample_rate=10000, symbol_duration=0.01)
```

```python
def qpsk_modulate(bit_seq, carrier_freq=1000, sample_rate=10000, symbol_duration=0.01)
```

#### 参数说明
| 参数名            | 描述                      | 默认值 |
| ----------------- | ------------------------- | ------ |
| `bit_seq`         | 由0和1组成的字符串        | 无     |
| `carrier_freq`    | 载波信号的频率（Hz）。    | 1000   |
| `sample_rate`     | 采样率（Hz）              | 10000  |
| `symbol_duration` | 每个比特的持续时间（s）。 | 0.01   |

#### 返回值
| 返回值             | 类型       | 描述                                                   |
| ------------------ | ---------- | ------------------------------------------------------ |
| `modulated_signal` | array-like | 经过 BPSK 调制后的信号，是一个包含调制后样本值的数组。 |

#### 异常处理
**`ValueError`**：如果输入的 `bit_seq` 中包含非 0 或 1 的元素，将抛出此异常。

### 接受信息格式

```python
0110101010001010101010100000100111110......
```

### 发送信息格式

以数组形式存储

```
[-1.         -0.80901699 -0.30901699  0.30901699  0.80901699  1.
  0.80901699  0.30901699 -0.30901699 -0.80901699 -1.         -0.80901699
 -0.30901699  0.30901699  0.80901699  1.          0.80901699  0.30901699
 -0.30901699 -0.80901699 -1.         -0.80901699 -0.30901699  0.30901699
  0.80901699  1.          0.80901699  0.30901699 -0.30901699 -0.80901699
 -1.         -0.80901699 -0.30901699  0.30901699  0.80901699  1.
  0.80901699  0.30901699 -0.30901699 -0.80901699 -1.         -0.80901699
 -0.30901699  0.30901699  0.80901699  1.          0.80901699  0.30901699
 -0.30901699 -0.80901699 -1.         -0.80901699 -0.30901699  0.30901699
  0.80901699  1.          0.80901699  0.30901699 -0.30901699 -0.80901699
 -1.         -0.80901699 -0.30901699  0.30901699  0.80901699  1.
  0.80901699  0.30901699 -0.30901699 -0.80901699 -1.         -0.80901699
 -0.30901699  0.30901699  0.80901699  1.          0.80901699  0.30901699
 -0.30901699 -0.80901699 -1.         -0.80901699 -0.30901699  0.30901699
  0.80901699  1.          0.80901699  0.30901699 -0.30901699 -0.80901699
 -1.         -0.80901699 -0.30901699  0.30901699  0.80901699  1.
  0.80901699  0.30901699 -0.30901699 -0.80901699]
```

### 测试用例

```python
if __name__ == "__main__":
    # 模拟前端请求中的比特流
    bitstream = np.random.randint(0, 2, 16)
    print("原始比特流:", bitstream)
    bpsk_signal = bpsk_modulate(bitstream)
    print("长度:", len(bpsk_signal))
    print(bpsk_signal)
```

```python
if __name__ == "__main__":
    # 模拟前端请求中的比特流
    bitstream = np.random.randint(0, 2, 16)
    print("原始比特流:", bitstream)
    qpsk_signal = qpsk_modulate(bitstream)
    print(qpsk_signal[i])
```



## 规划卫星路径：plan_satellite_path

### 接口信息

```python
plan_satellite_path(messages)
```

### 接受信息格式

```python
f{
    "Satellite {sat.index}: {sat.name}, Position: ({sat.r}, {sat.angle:.2f}, {1000.0 / self.opengl_widget.update_delta_t * sat.delta_deg:.2f",
    "Satellite {sat.index}: {sat.name}, Position: ({sat.r}, {sat.angle:.2f}, {1000.0 / self.opengl_widget.update_delta_t * sat.delta_deg:.2f",
    "Satellite {sat.index}: {sat.name}, Position: ({sat.r}, {sat.angle:.2f}, {1000.0 / self.opengl_widget.update_delta_t * sat.delta_deg:.2f"
    #......
}
```

示例

```python
messages = [
    "Satellite 1: Alpha, Position: (7000, 45.00, 2.50)",
    "Satellite 2: Beta, Position: (7100, 90.00, 2.30)",
    "Satellite 3: Gamma, Position: (7050, 135.00, 2.40)"
]
```

### 发送信息格式

```python
"{sat1} {sat2} {sat3} {sat4} ..."
```

示例

```python
1 2 3
```

### 测试用例

```python
if __name__ == '__main__':
	# 示例输入
    messages = [
        "Satellite 1: Alpha, Position: (7000, 45.00, 2.50)",
        "Satellite 2: Beta, Position: (7100, 90.00, 2.30)",
        "Satellite 3: Gamma, Position: (7050, 135.00, 2.40)"
    ]

    # 调用函数
    path = plan_satellite_path(messages, sort_by="angle")
    print("推荐路径:", path)
```